<!DOCTYPE html>
<html lang="sv">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>En kram Ã¤r pÃ¥ vÃ¤g till dig!</title>
    <meta name="description" content="FÃ¶r att sprida vÃ¤rme och omtanke, skicka en kram till nÃ¥gon du bryr dig om">
    <meta name="keywords" content="enkram, kram, vÃ¤rme, omtanke, svensk hemsida, kÃ¤rlek online">
    <meta name="author" content="Enkram.se">

    <meta property="og:title" content="En kram Ã¤r pÃ¥ vÃ¤g till dig!">
    <meta property="og:description"
        content="FÃ¶r att sprida vÃ¤rme och omtanke, skicka en kram till nÃ¥gon du bryr dig om.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://enkram.se">

    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>

<body>
    <main class="container" id="app">
        <!-- InnehÃ¥llet styrs av JavaScript -->
    </main>
    <script>
        async function sendKram(message) {
            const res = await fetch('/api/sendKram', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message })
            });

            if (!res.ok) {
                return { error: true };
            }

            return await res.json();
        }

        async function loadKram(id) {
            const res = await fetch(`/api/getKram/${id}`);
            if (!res.ok) return null;
            return await res.json();
        }

        function getIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        function renderForm() {
            document.getElementById('app').innerHTML = `
      <h1>Skicka en kram ðŸ¤—</h1>
      <form id="kramForm">
        <textarea id="message" placeholder="Skriv ett meddelande..." rows="4" cols="40"></textarea><br>
        <button type="submit" class="send-btn">
        <i class="fas fa-paper-plane"></i> Skicka
        </button>
      </form>
      <div id="result"></div>
    `;

            document.getElementById('kramForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const message = document.getElementById('message').value;
                const result = await sendKram(message);
                const resultDiv = document.getElementById('result');

                if (result.error) {
                    resultDiv.innerHTML = `<p>NÃ¥got gick fel ðŸ˜¢</p>`;
                } else {
                    const url = new URL(window.location.href);
                    url.searchParams.set('id', result.link.split('/').pop());
                    const encodedUrl = encodeURIComponent(url.toString());
                    resultDiv.innerHTML = `
  <h2>Din kram Ã¤r redo ðŸ’Œ</h2>
  <div class="share-buttons">
    <button onclick="window.open('https://wa.me/?text=${encodedUrl}', '_blank')">
      <i class="fab fa-whatsapp"></i> WhatsApp
    </button>
    <button onclick="window.open('https://t.me/share/url?url=${encodedUrl}', '_blank')">
      <i class="fab fa-telegram"></i> Telegram
    </button>
    <button onclick="navigator.clipboard.writeText('${url}').then(() => alert('LÃ¤nk kopierad!'))">
      <i class="fas fa-link"></i> Kopiera lÃ¤nk
    </button>
  </div>
`;
                }
            });
        }

        function renderKram(message) {
            document.getElementById('app').innerHTML = `
      <h1>Du har fÃ¥tt en kram ðŸ¤—</h1>
      <p>${message}</p>
      <p><a href="/">Skicka en egen kram</a></p>
    `;
        }

        function renderNotFound() {
            document.getElementById('app').innerHTML = `
      <h1>Oj dÃ¥ ðŸ˜¢</h1>
      <p>Kramen du letar efter finns inte lÃ¤ngre.</p>
      <p><a href="/">Skicka en egen kram</a></p>
    `;
        }

        (async function () {
            const id = getIdFromUrl();
            if (id) {
                const kram = await loadKram(id);
                if (kram) {
                    renderKram(kram.message);
                } else {
                    renderNotFound();
                }
            } else {
                renderForm();
            }
        })();
    </script>
</body>

</html>